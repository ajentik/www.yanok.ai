<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
  <head>{% include head.html %}
    <script defer src="https://www.yno.ai/widget.js"></script>
    <style>
      /* Custom scrollbar styles */
      #sidebar::-webkit-scrollbar {
        width: 6px;
      }

      #sidebar::-webkit-scrollbar-track {
        background: transparent;
      }

      #sidebar::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.3);
        border-radius: 20px;
        border: transparent;
      }

      #sidebar::-webkit-scrollbar-thumb:hover {
        background-color: rgba(255, 255, 255, 0.5);
      }

      /* Hide scrollbar when not needed */
      #sidebar {
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
      }

      #sidebar.overflow-hidden {
        scrollbar-width: none;
      }

      #sidebar.overflow-hidden::-webkit-scrollbar {
        display: none;
      }

      /* Apply 8% indent for main content sections */
      #content-wrapper > div {
        padding-left: 8%;
        padding-right: 8%;
      }

      /* Adjust submenu item brightness */
      .submenu a {
        opacity: 0.8;
      }
    </style>
  </head>

  <body class="font-jost antialiased text-white bg-gradient-to-br from-darkerBlue to-darkBlue flex">
    <script type="module" src="{{ '/assets/javascript/cookieconsent-config.js' | relative_url }}"></script>
    
    {% include navigation.html %}
    
    <div id="content-wrapper" class="flex-grow transition-all duration-300 ml-0 md:ml-64">
      <div class="flex flex-col items-center min-h-screen">
        <div class="grow w-full px-[8%]">{{ content }}</div>
        <div class="w-full">{% include footer.html %}</div>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const sidebar = document.getElementById('sidebar');
        const contentWrapper = document.getElementById('content-wrapper');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebarCollapse = document.getElementById('sidebar-collapse');
        const submenus = document.querySelectorAll('.submenu-toggle');

        function toggleSidebar() {
          sidebar.classList.toggle('-translate-x-full');
          contentWrapper.classList.toggle('ml-0');
          contentWrapper.classList.toggle('md:ml-64');
          sidebarToggle.classList.toggle('right-4');
          sidebarToggle.classList.toggle('left-4');
          saveMenuState();
        }

        function collapseSidebar() {
          sidebar.classList.toggle('w-64');
          sidebar.classList.toggle('w-16');
          contentWrapper.classList.toggle('md:ml-64');
          contentWrapper.classList.toggle('md:ml-16');
          
          const sidebarContent = document.querySelectorAll('#sidebar > *:not(:first-child, :last-child)');
          sidebarContent.forEach(el => el.classList.toggle('hidden'));
          
          sidebarCollapse.querySelector('svg').classList.toggle('rotate-180');
          
          // Toggle overflow on sidebar
          sidebar.classList.toggle('overflow-y-auto');
          sidebar.classList.toggle('overflow-hidden');

          // Ensure logo visibility
          const logo = sidebar.querySelector('img');
          logo.classList.toggle('w-10');
          logo.classList.toggle('w-6');
          
          saveMenuState();
        }

        function saveMenuState() {
          const isOpen = !sidebar.classList.contains('-translate-x-full');
          const isCollapsed = sidebar.classList.contains('w-16');
          const openSubmenus = Array.from(document.querySelectorAll('.submenu:not(.hidden)')).map(el => el.previousElementSibling.textContent.trim());
          localStorage.setItem('sidebarState', JSON.stringify({ isOpen, isCollapsed, openSubmenus }));
        }

        function loadMenuState() {
          const state = JSON.parse(localStorage.getItem('sidebarState')) || { isOpen: true, isCollapsed: false, openSubmenus: [] };
          if (state.isOpen && window.innerWidth >= 768) {
            sidebar.classList.remove('-translate-x-full');
            contentWrapper.classList.remove('ml-0');
            contentWrapper.classList.add('md:ml-64');
          }
          if (state.isCollapsed) {
            collapseSidebar();
          }
          state.openSubmenus.forEach(submenuTitle => {
            const submenuToggle = Array.from(submenus).find(el => el.textContent.trim() === submenuTitle);
            if (submenuToggle) {
              submenuToggle.nextElementSibling.classList.remove('hidden');
              submenuToggle.querySelector('svg').classList.add('rotate-180');
            }
          });
        }

        function handleResize() {
          if (window.innerWidth >= 768) {
            sidebar.classList.remove('-translate-x-full');
            contentWrapper.classList.remove('ml-0');
            contentWrapper.classList.add('md:ml-64');
            sidebarToggle.classList.add('hidden');
          } else {
            sidebar.classList.add('-translate-x-full');
            contentWrapper.classList.add('ml-0');
            contentWrapper.classList.remove('md:ml-64');
            sidebarToggle.classList.remove('hidden');
          }
        }

        loadMenuState();
        handleResize();

        window.addEventListener('resize', handleResize);
        sidebarToggle.addEventListener('click', toggleSidebar);
        sidebarCollapse.addEventListener('click', collapseSidebar);

        submenus.forEach(item => {
          item.addEventListener('click', (e) => {
            const submenu = item.nextElementSibling;
            submenu.classList.toggle('hidden');
            item.querySelector('svg').classList.toggle('rotate-180');
            saveMenuState();
          });
        });
      });
    </script>
  </body>
</html>
