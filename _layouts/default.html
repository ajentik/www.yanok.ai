<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
  <head>
    {% include head.html %}
    <style>
      /* Custom scrollbar styles with fade effect */
      #sidebar::-webkit-scrollbar {
        width: 6px;
        opacity: 0;
        transition: opacity 0.3s;
      }

      #sidebar:hover::-webkit-scrollbar {
        opacity: 1;
      }

      #sidebar::-webkit-scrollbar-track {
        background: transparent;
      }

      #sidebar::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.3);
        border-radius: 20px;
        border: transparent;
      }

      #sidebar::-webkit-scrollbar-thumb:hover {
        background-color: rgba(255, 255, 255, 0.5);
      }

      /* Hide scrollbar when not needed */
      #sidebar {
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
      }

      #sidebar.overflow-hidden {
        scrollbar-width: none;
      }

      #sidebar.overflow-hidden::-webkit-scrollbar {
        display: none;
      }

      /* Apply 2% indent and max width for main content sections */
      #content-wrapper > div:not(.w-full) {
        padding-left: 2%;
        padding-right: 2%;
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
      }

      /* Adjust submenu item brightness */
      .submenu a {
        opacity: 0.8;
      }

      /* New mobile layout adjustments */
      @media (max-width: 767px) {
        #sidebar {
          width: 100%;
          max-width: 256px;
          transform: translateX(-100%);
          transition: transform 0.3s ease-in-out;
        }

        #sidebar.active {
          transform: translateX(0);
        }

        #content-wrapper {
          margin-left: 0 !important;
          transition: margin-left 0.3s ease-in-out;
        }

        #content-wrapper.sidebar-open {
          margin-left: 256px;
        }

        #mobile-sidebar-toggle {
          display: block;
          transition: left 0.3s ease-in-out;
        }

        body.overflow-hidden {
          overflow: hidden;
        }

        /* Adjust content wrapper padding for fixed mobile toggle button */
        #content-wrapper {
          padding-top: 3.5rem;
        }

        #content-wrapper > div:not(#content-variation-menu) {
          font-size: 70%;
          line-height: 1.5;
        }

        #content-wrapper h1 {
          font-size: 1.75rem;
        }

        #content-wrapper h2 {
          font-size: 1.5rem;
        }

        #content-wrapper h3 {
          font-size: 1.25rem;
        }
      }

      /* Desktop layout adjustments */
      @media (min-width: 768px) {
        #content-wrapper.sidebar-collapsed {
          margin-left: 4rem !important;
        }
      }

      @media (min-width: 1201px) {
        #content-wrapper > div:not(.w-full) {
          padding-left: 8%;
          padding-right: 8%;
        }
      }

      #content-wrapper {
        transition: margin-left 0.3s ease-in-out;
      }

      #sidebar-overlay {
        transition: opacity 0.3s ease-in-out;
      }

      /* Core layout structure */
      #content-wrapper {
        position: relative;
        z-index: 10;
        min-height: 100vh;
        width: 100%;
        transition: margin-left 0.3s ease-in-out;
      }

      #content-wrapper main {
        position: relative;
        z-index: 1;
      }

      #sidebar {
        z-index: 50;
        position: fixed;
        left: 0;
        top: 0;
        height: 100vh;
        transition: transform 0.3s ease-in-out;
      }

      #mobile-sidebar-toggle {
        z-index: 55;
        transition: left 0.3s ease-in-out;
      }

      #sidebar-overlay {
        z-index: 40;
        transition: opacity 0.3s ease-in-out;
      }

      /* Mobile layout */
      @media (max-width: 767px) {
        #content-wrapper {
          margin-left: 0;
          width: 100%;
        }

        #sidebar {
          transform: translateX(-100%);
        }

        #sidebar.active {
          transform: translateX(0);
        }
      }

      /* Desktop layout */
      @media (min-width: 768px) {
        #content-wrapper {
          margin-left: 16rem;
          width: calc(100% - 16rem);
        }

        #content-wrapper.sidebar-collapsed {
          margin-left: 4rem;
          width: calc(100% - 4rem);
        }
      }
    </style>
  </head>

  <body class="font-jost antialiased text-white bg-gradient-to-br from-darkerBlue to-darkBlue flex">
    <button id="mobile-sidebar-toggle" class="md:hidden fixed top-14 left-4 z-50 bg-blue-500 p-2 rounded-full transition-all duration-300">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
    <script type="module" src="{{ '/assets/javascript/cookieconsent-config.js' | relative_url }}"></script>
    
    <div id="content-wrapper" class="flex-grow transition-all duration-300 ml-0 md:ml-64 pt-14">
      <main class="flex flex-col min-h-screen relative">
        <div class="flex-grow w-full px-4 md:px-8 relative z-10">
          {% include navigation.html %}
          {{ content }}
        </div>
        <div class="w-full relative z-10">{% include footer.html %}</div>
      </main>
    </div>

    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const sidebar = document.getElementById('sidebar');
        const contentWrapper = document.getElementById('content-wrapper');
        const sidebarCollapse = document.getElementById('sidebar-collapse');
        const submenus = document.querySelectorAll('.submenu-toggle');
        const mobileSidebarToggle = document.getElementById('mobile-sidebar-toggle');
        const overlay = document.getElementById('sidebar-overlay');

        function toggleSidebar() {
          const isActive = sidebar.classList.contains('active');
          
          sidebar.classList.toggle('active');
          contentWrapper.classList.toggle('sidebar-open');
          overlay.classList.toggle('hidden');
          document.body.classList.toggle('overflow-hidden');

          if (window.innerWidth < 768) {
            mobileSidebarToggle.style.left = isActive ? '16px' : '256px';
            sidebar.style.transform = isActive ? 'translateX(-100%)' : 'translateX(0)';
          }
          
          saveMenuState();
        }

        function collapseSidebar() {
          if (window.innerWidth >= 768) {
            sidebar.classList.toggle('w-64');
            sidebar.classList.toggle('w-16');
            contentWrapper.classList.toggle('md:ml-64');
            contentWrapper.classList.toggle('md:ml-16');
            contentWrapper.classList.toggle('sidebar-collapsed');

         
            const sidebarContent = document.querySelectorAll('#sidebar > *:not(:first-child, :last-child)');
            sidebarContent.forEach(el => el.classList.toggle('hidden'));
            
            sidebarCollapse.querySelector('svg').classList.toggle('rotate-180');
            
            sidebar.classList.toggle('overflow-y-auto');
            sidebar.classList.toggle('overflow-hidden');

            const logoContainer = sidebar.querySelector('#sidebar > div:first-child');
            logoContainer.classList.toggle('h-24');
            logoContainer.classList.toggle('w-24');
            logoContainer.classList.toggle('h-16');
            logoContainer.classList.toggle('w-16');
            
            saveMenuState();
          }
        }

        function saveMenuState() {

          const isOpen = sidebar.classList.contains('active');
          const isCollapsed = sidebar.classList.contains('w-16');
          const openSubmenus = Array.from(document.querySelectorAll('.submenu:not(.hidden)')).map(el => el.previousElementSibling.textContent.trim());
          localStorage.setItem('sidebarState', JSON.stringify({ isOpen, isCollapsed, openSubmenus }));
        }

        function loadMenuState() {
          const state = JSON.parse(localStorage.getItem('sidebarState')) || { isOpen: false, isCollapsed: false, openSubmenus: [] };
          if (state.isOpen && window.innerWidth >= 768) {
            sidebar.classList.add('active');
            contentWrapper.classList.add('sidebar-open');

          }
          if (state.isCollapsed && window.innerWidth >= 768) {
            collapseSidebar();
          }
          state.openSubmenus.forEach(submenuTitle => {
            const submenuToggle = Array.from(submenus).find(el => el.textContent.trim() === submenuTitle);
            if (submenuToggle) {
              submenuToggle.nextElementSibling.classList.remove('hidden');
              submenuToggle.querySelector('svg').classList.add('rotate-180');
            }
          });
        }

        function handleResize() {
          if (window.innerWidth >= 768) {
            sidebar.classList.remove('active');
            contentWrapper.classList.remove('sidebar-open');
            overlay.classList.add('hidden');
            mobileSidebarToggle.style.left = '16px';
            document.body.classList.remove('overflow-hidden');
          } else {
            sidebar.classList.remove('w-16');
            sidebar.classList.add('w-64');
            contentWrapper.classList.remove('md:ml-16');
            contentWrapper.classList.add('md:ml-64');
            
            if (!sidebar.classList.contains('active')) {
              mobileSidebarToggle.style.left = '16px';
            }
          }
          updateScrollbarVisibility();
        }

        function updateScrollbarVisibility() {
          if (sidebar.scrollHeight > sidebar.clientHeight) {
            sidebar.classList.add('overflow-y-auto');
            sidebar.classList.remove('overflow-hidden');
          } else {
            sidebar.classList.remove('overflow-y-auto');
            sidebar.classList.add('overflow-hidden');
          }
        }

        mobileSidebarToggle.addEventListener('click', toggleSidebar);
        overlay.addEventListener('click', toggleSidebar);
        sidebarCollapse.addEventListener('click', collapseSidebar);
        window.addEventListener('resize', handleResize);

        loadMenuState();
        handleResize();
        updateScrollbarVisibility();

        submenus.forEach(item => {
          item.addEventListener('click', (e) => {
            const submenuToggle = e.target.closest('.submenu-toggle');
            const link = e.target.closest('a');
            
            if (link && !submenuToggle) {
              // Allow normal link navigation
              return;
            }
            
            if (submenuToggle) {
              e.preventDefault();
              e.stopPropagation();
              const submenu = submenuToggle.nextElementSibling;
              submenu.classList.toggle('hidden');
              submenuToggle.querySelector('svg').classList.toggle('rotate-180');
              saveMenuState();
              updateScrollbarVisibility();
            }
          });
        });
        
        // Add new handler for all sidebar links
        document.querySelectorAll('#sidebar a').forEach(link => {
          link.addEventListener('click', (e) => {
            if (window.innerWidth < 768) {
              // Allow navigation to complete before closing mobile menu
              setTimeout(() => {
                sidebar.classList.remove('active');
                contentWrapper.classList.remove('sidebar-open');
                overlay.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
                mobileSidebarToggle.style.left = '16px';
              }, 100);
            }
          });
        });
      });
    </script>
  </body>
</html>
