<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
  <head>
    <script defer src="https://www.yno.ai/widget.js"></script>
    {% include head.html %}
    <style>
      /* Custom scrollbar styles with fade effect */
      #sidebar::-webkit-scrollbar {
        width: 6px;
        opacity: 0;
        transition: opacity 0.3s;
      }

      #sidebar:hover::-webkit-scrollbar {
        opacity: 1;
      }

      #sidebar::-webkit-scrollbar-track {
        background: transparent;
      }

      #sidebar::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.3);
        border-radius: 20px;
        border: transparent;
      }

      #sidebar::-webkit-scrollbar-thumb:hover {
        background-color: rgba(255, 255, 255, 0.5);
      }

      /* Hide scrollbar when not needed */
      #sidebar {
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
      }

      #sidebar.overflow-hidden {
        scrollbar-width: none;
      }

      #sidebar.overflow-hidden::-webkit-scrollbar {
        display: none;
      }

      /* Apply 5% indent and max width for main content sections */
      #content-wrapper > div:not(.w-full) {
        padding-left: 5%;
        padding-right: 5%;
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
      }

      /* Adjust submenu item brightness */
      .submenu a {
        opacity: 0.8;
      }

      /* Mobile layout adjustments */
      @media (max-width: 767px) {
        #sidebar {
          transform: translateX(-100%);
        }

        #sidebar.active {
          transform: translateX(0);
        }

        #content-wrapper {
          margin-left: 0 !important;
        }

        #mobile-sidebar-toggle {
          display: block;
        }
      }

      /* Desktop layout adjustments */
      @media (min-width: 768px) {
        #content-wrapper.sidebar-collapsed {
          margin-left: 4rem !important; /* 16px * 4 = 64px */
        }
      }

      #content-wrapper {
        transition: margin-left 0.3s ease-in-out;
      }

      @media (max-width: 767px) {
        #content-wrapper > div:not(#content-variation-menu) {
          font-size: 70%; /* Reduces font size by 30% */
          line-height: 1.5; /* Improves readability for smaller text */
        }

        #content-wrapper h1 {
          font-size: 1.75rem;
        }

        #content-wrapper h2 {
          font-size: 1.5rem;
        }

        #content-wrapper h3 {
          font-size: 1.25rem;
        }
      }

      @media (min-width: 1201px) {
        #content-wrapper > div:not(.w-full) {
          padding-left: 8%;
          padding-right: 8%;
        }
      }

      #content-wrapper {
        transition: margin-left 0.3s ease-in-out;
      }
    </style>
  </head>

  <body class="font-jost antialiased text-white bg-gradient-to-br from-darkerBlue to-darkBlue flex">
    <script type="module" src="{{ '/assets/javascript/cookieconsent-config.js' | relative_url }}"></script>
    
    {% include navigation.html %}
    
    <div id="content-wrapper" class="flex-grow transition-all duration-300 ml-0 md:ml-64 pt-14">
      <div class="flex flex-col items-center min-h-screen">
        <div class="grow w-full">
          <div data-content-variation="regular">{{ content }}</div>
          <div data-content-variation="manager" class="hidden">
            {% include content_variations/manager.html %}
          </div>
          <div data-content-variation="consultant" class="hidden">
            {% include content_variations/consultant.html %}
          </div>
          <div data-content-variation="engineer" class="hidden">
            {% include content_variations/engineer.html %}
          </div>
        </div>
        <div class="w-full">{% include footer.html %}</div>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const variationButtons = document.querySelectorAll('.variation-btn');
        const contentSections = document.querySelectorAll('[data-content-variation]');

        function setActiveVariation(variation) {
          variationButtons.forEach(button => {
            const isActive = button.dataset.variation === variation;
            button.classList.toggle('active', isActive);
            button.setAttribute('aria-pressed', isActive.toString());
          });

          contentSections.forEach(section => {
            section.classList.toggle('hidden', section.dataset.contentVariation !== variation && variation !== 'regular');
          });

          localStorage.setItem('selectedVariation', variation);
          
          // Update URL for bookmarking and sharing
          const url = new URL(window.location);
          url.searchParams.set('view', variation);
          history.pushState({}, '', url);
        }

        variationButtons.forEach(button => {
          button.addEventListener('click', () => {
            setActiveVariation(button.dataset.variation);
          });
        });

        // Handle initial load and browser back/forward
        window.addEventListener('popstate', () => {
          const urlParams = new URLSearchParams(window.location.search);
          const variation = urlParams.get('view') || 'regular';
          setActiveVariation(variation);
        });

        const urlParams = new URLSearchParams(window.location.search);
        const initialVariation = urlParams.get('view') || localStorage.getItem('selectedVariation') || 'regular';
        setActiveVariation(initialVariation);
      });
    </script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const sidebar = document.getElementById('sidebar');
        const contentWrapper = document.getElementById('content-wrapper');
        const sidebarCollapse = document.getElementById('sidebar-collapse');
        const submenus = document.querySelectorAll('.submenu-toggle');
        const mobileSidebarToggle = document.getElementById('mobile-sidebar-toggle');

        function toggleSidebar() {
          sidebar.classList.toggle('-translate-x-full');
          sidebar.classList.toggle('translate-x-0');
          contentWrapper.classList.toggle('ml-0');
          contentWrapper.classList.toggle('md:ml-64');
          document.body.classList.toggle('overflow-hidden');
          saveMenuState();
        }

        function collapseSidebar() {
          if (window.innerWidth >= 768) {
            sidebar.classList.toggle('w-64');
            sidebar.classList.toggle('w-16');
            contentWrapper.classList.toggle('md:ml-64');
            contentWrapper.classList.toggle('md:ml-16');
            contentWrapper.classList.toggle('sidebar-collapsed');
            
            const sidebarContent = document.querySelectorAll('#sidebar > *:not(:first-child, :last-child)');
            sidebarContent.forEach(el => el.classList.toggle('hidden'));
            
            sidebarCollapse.querySelector('svg').classList.toggle('rotate-180');
            
            sidebar.classList.toggle('overflow-y-auto');
            sidebar.classList.toggle('overflow-hidden');

            const logoContainer = sidebar.querySelector('#sidebar > div:first-child');
            logoContainer.classList.toggle('h-24');
            logoContainer.classList.toggle('w-24');
            logoContainer.classList.toggle('h-16');
            logoContainer.classList.toggle('w-16');
            
            saveMenuState();
          }
        }

        function saveMenuState() {
          const isOpen = !sidebar.classList.contains('-translate-x-full');
          const isCollapsed = sidebar.classList.contains('w-16');
          const openSubmenus = Array.from(document.querySelectorAll('.submenu:not(.hidden)')).map(el => el.previousElementSibling.textContent.trim());
          localStorage.setItem('sidebarState', JSON.stringify({ isOpen, isCollapsed, openSubmenus }));
        }

        function loadMenuState() {
          const state = JSON.parse(localStorage.getItem('sidebarState')) || { isOpen: true, isCollapsed: false, openSubmenus: [] };
          if (state.isOpen && window.innerWidth >= 768) {
            sidebar.classList.remove('-translate-x-full');
            sidebar.classList.add('translate-x-0');
            contentWrapper.classList.remove('ml-0');
            contentWrapper.classList.add('md:ml-64');
          } else if (window.innerWidth < 768) {
            sidebar.classList.add('-translate-x-full');
            sidebar.classList.remove('translate-x-0');
            contentWrapper.classList.add('ml-0');
            contentWrapper.classList.remove('md:ml-64');
          }
          if (state.isCollapsed) {
            collapseSidebar();
          }
          state.openSubmenus.forEach(submenuTitle => {
            const submenuToggle = Array.from(submenus).find(el => el.textContent.trim() === submenuTitle);
            if (submenuToggle) {
              submenuToggle.nextElementSibling.classList.remove('hidden');
              submenuToggle.querySelector('svg').classList.add('rotate-180');
            }
          });
        }

        function handleResize() {
          if (window.innerWidth >= 768) {
            sidebar.classList.remove('-translate-x-full');
            sidebar.classList.add('translate-x-0');
            contentWrapper.classList.remove('ml-0');
            contentWrapper.classList.add('md:ml-64');
          } else {
            sidebar.classList.add('-translate-x-full');
            sidebar.classList.remove('translate-x-0');
            contentWrapper.classList.add('ml-0');
            contentWrapper.classList.remove('md:ml-64');
          }
          updateScrollbarVisibility();
        }

        function updateScrollbarVisibility() {
          if (sidebar.scrollHeight > sidebar.clientHeight) {
            sidebar.classList.add('overflow-y-auto');
            sidebar.classList.remove('overflow-hidden');
          } else {
            sidebar.classList.remove('overflow-y-auto');
            sidebar.classList.add('overflow-hidden');
          }
        }

        mobileSidebarToggle.addEventListener('click', toggleSidebar);
        sidebarCollapse.addEventListener('click', collapseSidebar);
        window.addEventListener('resize', handleResize);

        loadMenuState();
        handleResize();
        updateScrollbarVisibility();

        document.querySelectorAll('.submenu a').forEach(link => {
          link.addEventListener('click', (e) => {
            e.preventDefault();
            const href = link.getAttribute('href');
            saveMenuState();
            window.location.href = href;
          });
        });

        submenus.forEach(item => {
          item.addEventListener('click', (e) => {
            const submenu = item.nextElementSibling;
            submenu.classList.toggle('hidden');
            item.querySelector('svg').classList.toggle('rotate-180');
            saveMenuState();
            updateScrollbarVisibility();
          });
        });
      });
    </script>
  </body>
</html>
